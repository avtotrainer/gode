<!doctype html>
<html lang="ka">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>á²á²á² á²¢á²¤á²á²šá²˜á²á²”á²‘á²˜</title>
    <meta
      name="description"
      content="áƒ¡áƒáƒ–áƒáƒ¤áƒ®áƒ£áƒšáƒ áƒ¡áƒ™áƒáƒšáƒ˜áƒ¡ áƒ›áƒáƒœáƒáƒ¬áƒ˜áƒšáƒ”áƒ—áƒ áƒáƒáƒ áƒ¢áƒ¤áƒáƒšáƒ˜áƒ-áƒ’áƒ•áƒ”áƒ áƒ“áƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒáƒ áƒ©áƒ”áƒ•áƒ˜ QR áƒ™áƒáƒ“áƒ”áƒ‘áƒ˜áƒ—."
    />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="icon" href="favicon.ico" />
    <meta name="theme-color" content="#0ea5e9" />
  </head>
  <body>
    <header>
      <div class="container">
        <nav>
          <div class="logo">ğŸ“š áƒáƒáƒ áƒ¢áƒ¤áƒáƒšáƒ˜áƒáƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒáƒ áƒ©áƒ”áƒ•áƒ˜</div>
          <div style="color: #9aa6bb">áƒ¡áƒáƒ–áƒáƒ¤áƒ®áƒ£áƒšáƒ áƒ¡áƒ™áƒáƒšáƒ</div>
        </nav>
      </div>
    </header>

    <main>
      <div class="container">
        <h1>áƒ¡áƒ¢áƒ£áƒ“áƒ”áƒœáƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒáƒáƒ áƒ¢áƒ¤áƒáƒšáƒ˜áƒáƒ”áƒ‘áƒ˜</h1>
        <p class="lead">
          áƒ¥áƒ•áƒ”áƒ›áƒáƒ— áƒœáƒáƒ®áƒáƒ•áƒ— áƒ§áƒ•áƒ”áƒšáƒ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ˜áƒšáƒ˜ áƒ”áƒ áƒ—áƒ’áƒ•áƒ”áƒ áƒ“áƒ˜áƒáƒœáƒ˜ áƒ¡áƒáƒ˜áƒ¢áƒ˜áƒ¡ áƒ‘áƒ›áƒ£áƒšáƒ¡. áƒ›áƒáƒ«áƒ”áƒ‘áƒœáƒ”
          áƒ¡áƒáƒ®áƒ”áƒšáƒ˜/áƒ”áƒš-áƒ¤áƒáƒ¡áƒ¢áƒ/áƒ‘áƒ›áƒ£áƒšáƒ˜, áƒ“áƒ áƒ¡áƒ™áƒáƒœáƒ˜áƒ áƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ” QR.
        </p>

        <!-- Tools -->
        <div class="tools">
          <label class="search" aria-label="áƒ«áƒ”áƒ‘áƒœáƒ">
            ğŸ”
            <input
              id="q"
              placeholder="áƒ«áƒ”áƒ‘áƒœáƒ: áƒ¡áƒáƒ®áƒ”áƒšáƒ˜, áƒ’áƒ•áƒáƒ áƒ˜, áƒ”áƒšáƒ¤áƒáƒ¡áƒ¢áƒ, githubâ€¦"
            />
            <button class="btn ghost" id="clear" type="button">
              áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ
            </button>
          </label>
          <button class="btn" id="copyCsv" type="button">CSV áƒ”áƒ¥áƒ¡áƒáƒáƒ áƒ¢áƒ˜</button>
        </div>

        <!-- Cards (dynamic) -->
        <div class="grid" id="list" aria-live="polite"></div>
      </div>
    </main>

    <footer>
      <div class="container">
        <div class="foot">
          <span
            >Â© <span id="y"></span> áƒ¡áƒáƒ–áƒáƒ¤áƒ®áƒ£áƒšáƒ áƒ¡áƒ™áƒáƒšáƒ â€” áƒáƒáƒ áƒ¢áƒ¤áƒáƒšáƒ˜áƒáƒ”áƒ‘áƒ˜áƒ¡
            áƒ¡áƒáƒ áƒ©áƒ”áƒ•áƒ˜</span
          >
          <span class="muted">áƒ’áƒáƒœáƒáƒ®áƒšáƒ“áƒ: <span id="lm"></span></span>
        </div>
      </div>
    </footer>

    <script>
      // áƒ¬áƒ”áƒšáƒ˜/áƒ‘áƒáƒšáƒ áƒªáƒ•áƒšáƒ˜áƒšáƒ”áƒ‘áƒ
      document.getElementById("y").textContent = new Date().getFullYear();
      document.getElementById("lm").textContent = new Date(
        document.lastModified,
      ).toLocaleDateString("ka-GE");

      // áƒ©áƒáƒ¨áƒ”áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ¡áƒ˜áƒ (fallback), áƒ—áƒ£ sites.json áƒ•áƒ”áƒ  áƒ©áƒáƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ
      const BUILTIN = [
        {
          name: "á²á²œá²á²œá² á²™á²á²®á²á²«á²”",
          email: "anano864@din.ge",
          url: "https://avtotrainer.github.io/anano",
          github: "https://github.com/avtotrainer/anano",
          tags: "á²•á²”á²‘ Â· Linux",
        },
        {
          name: "á²á²œá²á²¡á²¢á²á²¡á²˜á² á²¨á²á² á²á²¨á²˜á²«á²”",
          email: "anastasia9440@din.ge",
          url: "https://avtotrainer.github.io/taso",
          github: "https://github.com/avtotrainer/taso",
          tags: "GitHub Pages",
        },
        {
          name: "á²‘á²á²©á²˜ á²¯á²˜á²œá²­á²á² á²á²«á²”",
          email: "bachi096@din.ge",
          url: "https://avtotrainer.github.io/bachi",
          github: "https://github.com/avtotrainer/bachi/",
          tags: "Linux Â· Bash",
        },
        {
          name: "á²’á²˜á²’á²˜ á²ªá²”á²ªá²®á²šá²á²«á²”",
          email: "gigi240@din.ge",
          url: "https://avtotrainer.github.io/gigi",
          github: "https://github.com/avtotrainer/gigi",
          tags: "áƒ¡áƒ¢áƒáƒ¢áƒ˜áƒ™áƒ£áƒ áƒ˜ áƒ¡áƒáƒ˜áƒ¢áƒ˜",
        },
        {
          name: "á²’á²˜á²á² á²’á²˜ á²‘á²”á² á²˜á²«á²”",
          email: "giorgi@din.ge",
          url: "https://avtotrainer.github.io/gber",
          github: "https://github.com/avtotrainer/gber",
          tags: "WSLg Â· Git",
        },
        {
          name: "á²’á²˜á²á² á²’á²˜ á²—á²£á² á²›á²á²œá²˜á²«á²”",
          email: "giorgi030@din.ge",
          url: "https://avtotrainer.github.io/gtur",
          github: "https://github.com/avtotrainer/gtur",
          tags: "Linux Â· Pages",
        },
      ];

      // cards renderer
      const list = document.getElementById("list");
      function utm(url) {
        try {
          const u = new URL(url);
          if (u.protocol.startsWith("http")) {
            u.searchParams.set("utm_source", "index");
            u.searchParams.set("utm_medium", "toc");
            return u.toString();
          }
        } catch (e) {}
        return url;
      }
      function qrUrl(data) {
        // áƒáƒœáƒšáƒáƒ˜áƒœ QR áƒ’áƒ”áƒœáƒ”áƒ áƒáƒ¢áƒáƒ áƒ˜ (PNG). áƒ–áƒáƒ›áƒ 120x120; EC=H
        // áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒ áƒ¡áƒ®áƒ•áƒ áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ— áƒ©áƒáƒáƒœáƒáƒªáƒ•áƒšáƒ (áƒ›áƒáƒ’. api.qrserver.com)
        const enc = encodeURIComponent(data || "");
        return `https://api.qrserver.com/v1/create-qr-code/?size=120x120&ecc=H&data=${enc}`;
      }
      function cardTpl(item) {
        const url = utm(item.url || "#");
        const gh = item.github || "#";
        const qr = qrUrl(url);
        const emailSafe = item.email || "";
        const tags = item.tags || "áƒ•áƒ”áƒ‘";
        const el = document.createElement("article");
        el.className = "card";
        el.dataset.name = item.name || "";
        el.dataset.email = emailSafe;
        el.dataset.github = gh;
        el.innerHTML = `
        <div class="title">
          <span class="name">${item.name || "áƒ¡áƒáƒ®áƒ”áƒšáƒ˜"}</span>
          <span class="badge">${tags}</span>
        </div>
        <div class="meta">âœ‰ï¸ ${emailSafe}</div>
        <div class="actions">
          <a class="btn" href="${url}" target="_blank" rel="noopener">áƒœáƒáƒ®áƒ” áƒ¡áƒáƒ˜áƒ¢áƒ˜</a>
          <a class="btn ghost" href="${gh}" target="_blank" rel="noopener">GitHub</a>
        </div>
        <div class="qr">
          <img loading="lazy" src="${qr}" alt="QR áƒ™áƒáƒ“áƒ˜ â€” ${item.name}">
          <small>áƒ¡áƒ™áƒáƒœáƒ˜áƒ áƒ” QR áƒ“áƒ áƒ’áƒáƒ“áƒáƒ“áƒ˜ áƒ¡áƒáƒ˜áƒ¢áƒ–áƒ”.</small>
        </div>
      `;
        return el;
      }
      function render(data) {
        list.innerHTML = "";
        (data || []).forEach((item) => list.appendChild(cardTpl(item)));
      }

      // áƒ¡áƒªáƒáƒ“áƒ” JSON áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ; áƒ’áƒáƒ—áƒ˜áƒ¨áƒ•áƒ˜áƒ¡ áƒ¨áƒ”áƒ›áƒ—áƒ®áƒ•áƒ”áƒ•áƒáƒ¨áƒ˜ â€” BUILTIN
      async function boot() {
        try {
          const res = await fetch("./sites.json", { cache: "no-store" });
          if (!res.ok) throw new Error("no json");
          const json = await res.json();
          if (!Array.isArray(json)) throw new Error("bad format");
          render(json);
        } catch (e) {
          render(BUILTIN);
        }
        attachSearchAndExport();
      }

      // áƒ«áƒ˜áƒ”áƒ‘áƒ + áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ + CSV
      function attachSearchAndExport() {
        const q = document.getElementById("q");
        const clear = document.getElementById("clear");
        const cards = [...document.querySelectorAll("#list .card")];

        function filter() {
          const v = (q.value || "").toLowerCase().trim();
          cards.forEach((c) => {
            const hay = (
              c.dataset.name +
              " " +
              c.dataset.email +
              " " +
              c.dataset.github
            ).toLowerCase();
            c.classList.toggle("hidden", v && !hay.includes(v));
          });
        }
        q.addEventListener("input", filter);
        clear.addEventListener("click", () => {
          q.value = "";
          filter();
          q.focus();
        });

        // CSV áƒ”áƒ¥áƒ¡áƒáƒáƒ áƒ¢áƒ˜ â€” áƒ®áƒ˜áƒšáƒ£áƒšáƒ˜ áƒ‘áƒáƒ áƒáƒ—áƒ”áƒ‘áƒ˜
        document.getElementById("copyCsv").addEventListener("click", () => {
          const rows = [["áƒ¡áƒáƒ®áƒ”áƒšáƒ˜", "áƒ”áƒšáƒ¤áƒáƒ¡áƒ¢áƒ", "áƒ¡áƒáƒ˜áƒ¢áƒ˜", "GitHub"]];
          document.querySelectorAll("#list .card:not(.hidden)").forEach((c) => {
            const name = c.dataset.name || "";
            const email = c.dataset.email || "";
            const url = c.querySelector(".actions a.btn")?.href || "";
            const gh = c.querySelector(".actions a.btn.ghost")?.href || "";
            rows.push([name, email, url, gh]);
          });
          const csv = rows
            .map((r) =>
              r.map((x) => `"${String(x).replaceAll('"', '""')}"`).join(","),
            )
            .join("\n");
          navigator.clipboard
            .writeText(csv)
            .then(() => {
              alert("CSV áƒ“áƒáƒ™áƒáƒáƒ˜áƒ áƒ“áƒ áƒ™áƒšáƒ˜áƒáƒ‘áƒáƒ áƒ“áƒ¨áƒ˜.");
            })
            .catch(() => {
              // fallback: áƒ©áƒáƒ›áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ¤áƒáƒ˜áƒšáƒáƒ“
              const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
              const a = document.createElement("a");
              a.href = URL.createObjectURL(blob);
              a.download = "sites.csv";
              document.body.appendChild(a);
              a.click();
              a.remove();
            });
        });
      }

      boot();
    </script>
  </body>
</html>
